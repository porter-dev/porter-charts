agent:
  image: "ghcr.io/porter-dev/releases/porter-agent:3.5.2"
  cfAccessToken: ""
  porterHost: "dashboard.porter.run"
  porterPort: "80"
  porterToken: ""
  privateRegistry:
    enabled: false
    secret: ""
  clusterID: ""
  projectID: ""
  region: ""
  lokiURL: porter-agent-loki.porter-agent-system:9095
  lokiHTTPURL: http://porter-agent-loki.porter-agent-system:3100
  prometheusURL: http://prometheus-server.monitoring.svc
  # NOTE: if updating the measurement period, MAKE SURE TO ALSO UPDATE THE PROMETHEUS QUERY FOR CALCULATING THE AVERAGE RESOURCE USAGE
  billingMeasurementPeriod: "5m"
  serviceAccount:
    annotations: {}

resources:
  limits:
    cpu: 500m
    memory: 1024Mi
  requests:
    cpu: 500m
    memory: 1024Mi

nodeSelector: {}
tolerations: []

loki:
  deploymentMode: SingleBinary
  resultsCache:
    enabled: false
  chunksCache:
    enabled: false
  sidecar:
    rules:
      enabled: false
  lokiCanary:
    enabled: false
  ingester:
    replicas: 0
  distributor:
    replicas: 0
  querier:
    replicas: 0
  queryFrontend:
    replicas: 0
  queryScheduler:
    replicas: 0
  indexGateway:
    replicas: 0
  compactor:
    replicas: 0
  ruler:
    replicas: 0
  write:
    replicas: 0
  read:
    replicas: 0
  backend:
    replicas: 0
  loki:
    image:
      tag: 3.5.4
    configStorageType: ConfigMap
    configObjectName: porter-agent-loki-config
    generatedConfigObjectName: porter-agent-loki-config
    auth_enabled: false
    server:
      http_listen_port: 3100
      grpc_listen_port: 9095
    commonConfig:
      replication_factor: 1
      path_prefix: /var/loki
      storage:
        filesystem:
          chunks_directory: /var/loki/chunks
          rules_directory: /var/loki/rules
    schemaConfig:
      configs:
        - from: "2022-04-10"
          store: boltdb-shipper
          object_store: filesystem
          schema: v12
          index:
            prefix: loki_index_
            period: 24h
        - from: "2024-04-01"
          object_store: filesystem
          store: tsdb
          schema: v13
          index:
            prefix: index_
            period: 24h
    compactor:
      retention_enabled: true
      retention_delete_delay: 0h
      retention_delete_worker_count: 50
      delete_request_store: filesystem
    limits_config:
      max_label_names_per_series: 50
      reject_old_samples: true
      reject_old_samples_max_age: 168h
      max_concurrent_tail_requests: 50
      retention_period: 168h
    storage_config:
      filesystem:
        directory: /var/loki/chunks
    readinessProbe:
      httpGet:
        path: /ready
        port: http-metrics
      initialDelaySeconds: 45
    livenessProbe:
      httpGet:
        path: /ready
        port: http-metrics
      initialDelaySeconds: 45
  enabled: true
  gateway:
    enabled: false
  isDefault: true
  minio:
    enabled: false
  monitoring:
    selfMonitoring:
      enabled: false
    lokiCanary:
      enabled: false
  test:
    enabled: false
  singleBinary:
    affinity: {}
    service:
      labels: {}
    replicas: 1
    nodeSelector:
      porter.run/workload-kind: monitoring
    tolerations:
      - effect: NoSchedule
        key: porter.run/workload-kind
        value: "monitoring"
        operator: Equal
    persistence:
      enabled: true
      size: 100Gi
    resources:
      limits:
        cpu: 500m
        memory: 1024Mi
      requests:
        cpu: 500m
        memory: 1024Mi
  url: http://{{(include "loki.serviceName" .)}}:{{ .Values.loki.service.port }}

promtail:
  enabled: true
  config:
    logLevel: info
    serverPort: 3101
    clients:
      - url: http://{{ .Release.Name }}-loki.{{ .Release.Namespace }}:3100/loki/api/v1/push
    # See https://github.com/grafana/helm-charts/blob/18282f1780c73130a89ba5e0ee0f8c5721f08b13/charts/promtail/values.yaml#L343
    snippets:
      extraRelabelConfigs:
        - source_labels: [__meta_kubernetes_pod_container_id]
          target_label: container_id
          regex: ".*://(.*)$" # Remove the runtime prefix (containerd://, docker://)
          replacement: "${1}"
        - source_labels:
            - __meta_kubernetes_namespace
            - __meta_kubernetes_pod_name
            - __meta_kubernetes_pod_annotation_helm_sh_revision
          target_label: porter_pod_name
          action: replace
          separator: "_"
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
  resources:
    limits:
      memory: 256Mi
    requests:
      memory: 256Mi

complianceReconciler:
  enabled: false
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi
